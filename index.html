<!DOCTYPE html>
<html lang="en">
<head></head>
<body>

<script>
    function controlleduaf() {
        let obj = { data: "abcdefghijklmnopqrstuvwxyz" };
        let ref = obj;
        console.log("Before freeing:", ref.data);
        obj = null;
        try {
            console.log("After freeing:", ref.data);
        } catch (e) {
            alert("Error:", e.message);
        }
    }

    function ComplexOverflow() {
        let largeString = "A".repeat(1000000); 
        let bufferArray = [];
        let nestedArray = [];
        let obj = {};
        let counter = 0;
        let counterr = 0;

        function stringConcatenation() {
            largeString += largeString;
            if (largeString.length > 100000000) {
                largeString = "A".repeat(1000000);
            }
        }

        function arrayBufferAllocation() {
            bufferArray.push(new ArrayBuffer(1000000));
            if (bufferArray.length > 1000) {
                bufferArray = [];
            }
        }

        function handleNestedArrays() {
            nestedArray.push([]);
            if (nestedArray.length > 1000) {
                nestedArray = [];
            }
        }

        function handleObjectPropertyExpansion() {
            obj[counter] = "A".repeat(1000);
            counter++;
            if (counter > 10000000) {
                obj = {};
                counter = 0;
            }
        }

        function checkReload() {
            counterr++;
            if (counterr >= 100) {
                location.reload();
            }
        }

        alert("Running //String conc Debug");
        stringConcatenation();

        alert("Running //Array Buffer Allocation Debug");
        arrayBufferAllocation();

        alert("Running /Nested Arrays");
        handleNestedArrays();

        alert("Running //Reload Debug");
        checkReload();

        handleObjectPropertyExpansion();
    }

    let MTestClassesArray = [];

    class MTestClass {
        constructor() {}
    }

    const create_1000_objects = () => {
        let counter = 0;
        controlleduaf()
        while (true) {
            let obj = { data: "important data" };
            let ref = obj;
            console.log("Before freeing:", ref.data);
            obj = null;
            try {
                console.log("After freeing:", ref.data);
            } catch (e) {
                console.log("Error:", e.message);
            }
            counter++;
            if (counter >= 500) {
                location.reload();
            }
            for (let i = 0; i < 1000; i++) {
                MTestClassesArray.push(new MTestClass());
            }
            const text = `Total ${MTestClassesArray.length} MTestClass objects created`;
            document.getElementById('divMsg').innerHTML = text;
        }
    }

    function overflow_string() {
        let largeString = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        while (true) {
            largeString += largeString;
            if (largeString.length > 1000000000) {
                largeString = "A".repeat(1000000);
            }
        }
    }
</script>

<button onclick="controlleduaf()">Run controlleduaf</button>
<button onclick="ComplexOverflow()">Run ComplexOverflow</button>
<button onclick="create_1000_objects()">Run create_1000_objects</button>
<button onclick="overflow_string()">Run overflow_string</button>

</body>
</html>
